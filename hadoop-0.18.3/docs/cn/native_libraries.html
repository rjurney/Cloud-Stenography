<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta content="Apache Forrest" name="Generator">
<meta name="Forrest-version" content="0.8">
<meta name="Forrest-skin-name" content="pelt">
<title>Hadoop本地库</title>
<link type="text/css" href="skin/basic.css" rel="stylesheet">
<link media="screen" type="text/css" href="skin/screen.css" rel="stylesheet">
<link media="print" type="text/css" href="skin/print.css" rel="stylesheet">
<link type="text/css" href="skin/profile.css" rel="stylesheet">
<script src="skin/getBlank.js" language="javascript" type="text/javascript"></script><script src="skin/getMenu.js" language="javascript" type="text/javascript"></script><script src="skin/fontsize.js" language="javascript" type="text/javascript"></script>
<link rel="shortcut icon" href="images/favicon.ico">
</head>
<body onload="init()">
<script type="text/javascript">ndeSetTextSize();</script>
<div id="top">
<!--+
    |breadtrail
    +-->
<div class="breadtrail">
<a href="http://www.apache.org/">Apache</a> &gt; <a href="http://hadoop.apache.org/">Hadoop</a> &gt; <a href="http://hadoop.apache.org/core/">Core</a><script src="skin/breadcrumbs.js" language="JavaScript" type="text/javascript"></script>
</div>
<!--+
    |header
    +-->
<div class="header">
<!--+
    |start group logo
    +-->
<div class="grouplogo">
<a href="http://hadoop.apache.org/"><img class="logoImage" alt="Hadoop" src="images/hadoop-logo.jpg" title="Apache Hadoop"></a>
</div>
<!--+
    |end group logo
    +-->
<!--+
    |start Project Logo
    +-->
<div class="projectlogo">
<a href="http://hadoop.apache.org/core/"><img class="logoImage" alt="Hadoop" src="images/core-logo.gif" title="Scalable Computing Platform"></a>
</div>
<!--+
    |end Project Logo
    +-->
<!--+
    |start Search
    +-->
<div class="searchbox">
<form action="http://www.google.com/search" method="get" class="roundtopsmall">
<input value="hadoop.apache.org" name="sitesearch" type="hidden"><input onFocus="getBlank (this, 'Search the site with google');" size="25" name="q" id="query" type="text" value="Search the site with google">&nbsp; 
                    <input name="Search" value="Search" type="submit">
</form>
</div>
<!--+
    |end search
    +-->
<!--+
    |start Tabs
    +-->
<ul id="tabs">
<li>
<a class="unselected" href="http://hadoop.apache.org/core/">项目</a>
</li>
<li>
<a class="unselected" href="http://wiki.apache.org/hadoop">维基</a>
</li>
<li class="current">
<a class="selected" href="index.html">Hadoop 0.18文档</a>
</li>
</ul>
<!--+
    |end Tabs
    +-->
</div>
</div>
<div id="main">
<div id="publishedStrip">
<!--+
    |start Subtabs
    +-->
<div id="level2tabs"></div>
<!--+
    |end Endtabs
    +-->
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<!--+
    |breadtrail
    +-->
<div class="breadtrail">

             &nbsp;
           </div>
<!--+
    |start Menu, mainarea
    +-->
<!--+
    |start Menu
    +-->
<div id="menu">
<div onclick="SwitchMenu('menu_selected_1.1', 'skin/')" id="menu_selected_1.1Title" class="menutitle" style="background-image: url('skin/images/chapter_open.gif');">文档</div>
<div id="menu_selected_1.1" class="selectedmenuitemgroup" style="display: block;">
<div class="menuitem">
<a href="index.html">概述</a>
</div>
<div class="menuitem">
<a href="quickstart.html">快速入门</a>
</div>
<div class="menuitem">
<a href="cluster_setup.html">集群搭建</a>
</div>
<div class="menuitem">
<a href="hdfs_design.html">HDFS构架设计</a>
</div>
<div class="menuitem">
<a href="hdfs_user_guide.html">HDFS使用指南</a>
</div>
<div class="menuitem">
<a href="hdfs_permissions_guide.html">HDFS权限指南</a>
</div>
<div class="menuitem">
<a href="hdfs_quota_admin_guide.html">HDFS配额管理指南</a>
</div>
<div class="menuitem">
<a href="commands_manual.html">命令手册</a>
</div>
<div class="menuitem">
<a href="hdfs_shell.html">FS Shell使用指南</a>
</div>
<div class="menuitem">
<a href="distcp.html">DistCp使用指南</a>
</div>
<div class="menuitem">
<a href="mapred_tutorial.html">Map-Reduce教程</a>
</div>
<div class="menupage">
<div class="menupagetitle">Hadoop本地库</div>
</div>
<div class="menuitem">
<a href="streaming.html">Streaming</a>
</div>
<div class="menuitem">
<a href="hadoop_archives.html">Hadoop Archives</a>
</div>
<div class="menuitem">
<a href="hod.html">Hadoop On Demand</a>
</div>
<div class="menuitem">
<a href="http://hadoop.apache.org/core/docs/r0.18.2/api/index.html">API参考</a>
</div>
<div class="menuitem">
<a href="http://hadoop.apache.org/core/docs/r0.18.2/jdiff/changes.html">API Changes</a>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/hadoop/">维基</a>
</div>
<div class="menuitem">
<a href="http://wiki.apache.org/hadoop/FAQ">常见问题</a>
</div>
<div class="menuitem">
<a href="http://hadoop.apache.org/core/mailing_lists.html">邮件列表</a>
</div>
<div class="menuitem">
<a href="http://hadoop.apache.org/core/docs/r0.18.2/releasenotes.html">发行说明</a>
</div>
<div class="menuitem">
<a href="http://hadoop.apache.org/core/docs/r0.18.2/changes.html">变更日志</a>
</div>
</div>
<div id="credit"></div>
<div id="roundbottom">
<img style="display: none" class="corner" height="15" width="15" alt="" src="skin/images/rc-b-l-15-1body-2menu-3menu.png"></div>
<!--+
  |alternative credits
  +-->
<div id="credit2"></div>
</div>
<!--+
    |end Menu
    +-->
<!--+
    |start content
    +-->
<div id="content">
<div title="Portable Document Format" class="pdflink">
<a class="dida" href="native_libraries.pdf"><img alt="PDF -icon" src="skin/images/pdfdoc.gif" class="skin"><br>
        PDF</a>
</div>
<h1>Hadoop本地库</h1>
<div id="minitoc-area">
<ul class="minitoc">
<li>
<a href="#%E7%9B%AE%E7%9A%84">目的</a>
</li>
<li>
<a href="#%E7%BB%84%E4%BB%B6">组件</a>
</li>
<li>
<a href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95">使用方法</a>
</li>
<li>
<a href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%B9%B3%E5%8F%B0">支持的平台</a>
</li>
<li>
<a href="#%E6%9E%84%E5%BB%BAHadoop%E6%9C%AC%E5%9C%B0%E5%BA%93">构建Hadoop本地库</a>
<ul class="minitoc">
<li>
<a href="#%E6%B3%A8%E6%84%8F">注意</a>
</li>
</ul>
</li>
<li>
<a href="#%E4%BD%BF%E7%94%A8DistributedCache+%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E5%BA%93"> 使用DistributedCache 加载本地库</a>
</li>
</ul>
</div>
  
    
<a name="N1000D"></a><a name="%E7%9B%AE%E7%9A%84"></a>
<h2 class="h3">目的</h2>
<div class="section">
<p>
     鉴于性能问题以及某些Java类库的缺失，对于某些组件，Hadoop提供了自己的本地实现。
	这些组件保存在Hadoop的一个独立的动态链接的库里。这个库在*nix平台上叫<em>libhadoop.so</em>. 本文主要介绍本地库的使用方法以及如何构建本地库。
</p>
</div>
    
    
<a name="N1001A"></a><a name="%E7%BB%84%E4%BB%B6"></a>
<h2 class="h3">组件</h2>
<div class="section">
<p>Hadoop现在已经有以下
      <a href="http://hadoop.apache.org/core/docs/r0.18.2/api/org/apache/hadoop/io/compress/CompressionCodec.html">
      compression codecs</a>本地组件：</p>
<ul>
        
<li>
<a href="http://www.zlib.net/">zlib</a>
</li>
        
<li>
<a href="http://www.gzip.org/">gzip</a>
</li>
        
<li>
<a href="http://www.oberhumer.com/opensource/lzo/">lzo</a>
</li>
      
</ul>
<p>在以上组件中，lzo和gzip压缩编解码器必须使用hadoop本地库才能运行。
      </p>
</div>

    
<a name="N1003D"></a><a name="%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"></a>
<h2 class="h3">使用方法</h2>
<div class="section">
<p>hadoop本地库的用法很简单：</p>
<ul>
        
<li>
          看一下
	<a href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%B9%B3%E5%8F%B0">支持的平台</a>.
        </li>
        
<li>
           
<a href="http://hadoop.apache.org/core/releases.html#Download">下载</a> 预构建的32位i386架构的Linux本地hadoop库（可以在hadoop发行版的<span class="codefrag">lib/native</span>目录下找到）或者自己
          <a href="#%E6%9E%84%E5%BB%BAHadoop%E6%9C%AC%E5%9C%B0%E5%BA%93">构建</a> 这些库。
        </li>
        
<li>
          确保你的平台已经安装了<strong>zlib-1.2</strong>以上版本或者<strong>lzo2.0</strong>以上版本的软件包或者两者均已安装（根据你的需要）。
        </li>
      
</ul>
<p>
<span class="codefrag">bin/hadoop</span> 脚本通过系统属性
      <em>-Djava.library.path=&lt;path&gt;</em>来确认hadoop本地库是否包含在库路径里。</p>
<p>检查hadoop日志文件可以查看hadoop库是否正常，正常情况下会看到：</p>
<p>
        
<span class="codefrag">
          DEBUG util.NativeCodeLoader - Trying to load the custom-built 
          native-hadoop library... 
        </span>
<br>
        
<span class="codefrag">
          INFO  util.NativeCodeLoader - Loaded the native-hadoop library
        </span>
      
</p>
<p>如果出错，会看到：</p>
<p>
        
<span class="codefrag">
          INFO util.NativeCodeLoader - Unable to load native-hadoop library for 
          your platform... using builtin-java classes where applicable
        </span>
      
</p>
</div>
    
    
<a name="N10086"></a><a name="%E6%94%AF%E6%8C%81%E7%9A%84%E5%B9%B3%E5%8F%B0"></a>
<h2 class="h3">支持的平台</h2>
<div class="section">
<p>Hadoop本地库只支持*nix平台，已经广泛使用在GNU/Linux平台上，但是不支持
      <a href="http://www.cygwin.com/">Cygwin</a> 
      和 <a href="http://www.apple.com/macosx">Mac OS X</a>。 
      </p>
<p>已经测试过的GNU/Linux发行版本：</p>
<ul>
        
<li>
          
<a href="http://www.redhat.com/rhel/">RHEL4</a>/<a href="http://fedora.redhat.com/">Fedora</a>
        
</li>
        
<li>
<a href="http://www.ubuntu.com/">Ubuntu</a>
</li>
        
<li>
<a href="http://www.gentoo.org/">Gentoo</a>
</li>
      
</ul>
<p>在上述平台上，32/64位Hadoop本地库分别能和32/64位的jvm一起正常运行。
      </p>
</div>
    
    
<a name="N100B6"></a><a name="%E6%9E%84%E5%BB%BAHadoop%E6%9C%AC%E5%9C%B0%E5%BA%93"></a>
<h2 class="h3">构建Hadoop本地库</h2>
<div class="section">
<p>Hadoop本地库使用
      <a href="http://en.wikipedia.org/wiki/ANSI_C">ANSI C</a> 编写，使用GNU autotools工具链 (autoconf, autoheader, automake, autoscan, libtool)构建。也就是说构建hadoop库的平台需要有标准C的编译器和GNU autotools工具链。请参看
      <a href="#%E6%94%AF%E6%8C%81%E7%9A%84%E5%B9%B3%E5%8F%B0">支持的平台</a>。</p>
<p>你的目标平台上可能会需要的软件包：
      </p>
<ul>
        
<li>
          C 编译器 (e.g. <a href="http://gcc.gnu.org/">GNU C Compiler</a>)
        </li>
        
<li>
          GNU Autools 工具链: 
          <a href="http://www.gnu.org/software/autoconf/">autoconf</a>, 
          <a href="http://www.gnu.org/software/automake/">automake</a>, 
          <a href="http://www.gnu.org/software/libtool/">libtool</a>
        
</li>
        
<li> 
          zlib开发包 (stable version &gt;= 1.2.0)
        </li>
        
<li> 
          lzo开发包 (stable version &gt;= 2.0)
        </li> 
      
</ul>
<p>如果已经满足了上述先决条件，可以使用<span class="codefrag">build.xml</span> 
      文件，并把其中的<span class="codefrag">compile.native</span>置为 
      <span class="codefrag">true</span>，这样就可以生成hadoop本地库：</p>
<p>
<span class="codefrag">$ ant -Dcompile.native=true &lt;target&gt;</span>
</p>
<p>因为不是所有用户都需要Hadoop本地库，所以默认情况下hadoop不生成该库。
      </p>
<p>你可以在下面的路径查看新生成的hadoop本地库：</p>
<p>
<span class="codefrag">$ build/native/&lt;platform&gt;/lib</span>
</p>
<p>其中&lt;platform&gt;是下列系统属性的组合 
      <span class="codefrag">${os.name}-${os.arch}-${sun.arch.data.model}</span>；例如 
      Linux-i386-32。</p>
<a name="N10109"></a><a name="%E6%B3%A8%E6%84%8F"></a>
<h3 class="h4">注意</h3>
<ul>
          
<li>
            在生成hadoop本地库的目标平台上<strong>必须</strong> 安装了zlib和lzo开发包；但是如果你只希望使用其中一个的话，在部署时，安装其中任何一个都是足够的。
          </li>
          
<li>
		  在目标平台上生成以及部署hadoop本地库时，都需要根据32/64位jvm选取对应的32/64位zlib/lzo软件包。
          </li>
        
</ul>
</div>
<!--DCCOMMENT:diff begin-->
    
<a name="N1011F"></a><a name="%E4%BD%BF%E7%94%A8DistributedCache+%E5%8A%A0%E8%BD%BD%E6%9C%AC%E5%9C%B0%E5%BA%93"></a>
<h2 class="h3"> 使用DistributedCache 加载本地库</h2>
<div class="section">
<p>用户可以通过
      <a href="mapred_tutorial.html#DistributedCache">DistributedCache</a>
      加载本地共享库，并<em>分发</em>和建立库文件的<em>符号链接</em>。
      </p>
<p>这个例子描述了如何分发库文件并在从map/reduce任务中装载库文件。
      </p>
<ol>
      
<li>首先拷贝库文件到HDFS。<br>
      
<span class="codefrag">bin/hadoop fs -copyFromLocal mylib.so.1 /libraries/mylib.so.1</span>
      
</li>
      
<li>启动作业时包含以下代码：<br>
      
<span class="codefrag"> DistributedCache.createSymlink(conf); </span> 
<br>
      
<span class="codefrag"> DistributedCache.addCacheFile("hdfs://host:port/libraries/mylib.so.1#mylib.so", conf);
      </span>
      
</li>
      
<li>map/reduce任务中包含以下代码：<br>
      
<span class="codefrag"> System.loadLibrary("mylib.so"); </span>
      
</li>
      
</ol>
</div>
  
</div>
<!--+
    |end content
    +-->
<div class="clearboth">&nbsp;</div>
</div>
<div id="footer">
<!--+
    |start bottomstrip
    +-->
<div class="lastmodified">
<script type="text/javascript"><!--
document.write("Last Published: " + document.lastModified);
//  --></script>
</div>
<div class="copyright">
        Copyright &copy;
         2007 <a href="http://www.apache.org/licenses/">The Apache Software Foundation.</a>
</div>
<!--+
    |end bottomstrip
    +-->
</div>
</body>
</html>
